# 1장. 사용자 수에 따른 규모 확장성

## 어떤 데이터베이스를 선택해야할까?
데이터베이스의 종류는 크게 관계형 데이터베이스와 비관계형 데이터베이스로 나뉜다.  
그 중 대부분의 웹 서비스에서는 관계형 데이터베이스를 주로 사용한다.  
왜냐하면 웹서비스에서는 여러 테이블의 데이터들이 연관되는 경우가 많아서 각 테이블들의 데이터가 무결성, 정합성 등을 보장하는 것을 중요하기 때문이다.  

### 그렇다면 NoSQL은 언제 사용할까?
NoSQL은 메인 데이터베이스로 사용하기보다는 조회용 데이터베이스로 사용하는 편이다  
RDBMS에서는 여러 테이블을 JOIN해서 데이터를 조회하는 경우가 많은데 JOIN연산이 잦아지면 조회성능에 좋지 않다.  
그래서 NoSQL을 조회용 데이터베이스로 사용하고 RDBMS는 데이터를 저장할 때 사용하는 방법을 채택하는 경우가 많다고 한다.  

NoSQL은 외래키 제약조건같은 메타 데이터를 저장하지 않기 때문에 RDBMS에 비해서 비교적 많은 데이터를 저장할 수 있다.  
또한 제약조건을 확인하지 않아도 되기 때문에 조회성능이 RDBMS에 비해 좋다.  
그렇기 때문에 JOIN연산된 데이터를 NoSQL에 저장해서 조회성능을 개선할 수 있다.

> 대부분의 서비스에서는 쓰기 연산보다는 읽기 연산이 더 많으므로 이 방식을 채택하는건 효율적이라고 볼 수 있을 것 같다.

## 무상태 웹 계층
분산서비스가 되면 세션같은 상태를 가지는 서버를 만들면 안된다.  
클라이언트의 요청에서 상태값을 필요로할 때 세션이 저장된 서버가 아니라 다른 서버로 연결되면 상태값을 사용할 수 없기 때문이다.  
스티키세션을 통해 세션이 저장된 곳으로 연결을 할 수는 있지만 이 방법을 쓰면 분산서버를 구성한 의미가 많이 퇴색되고 로드 밸런서에도 부담을 주게 된다.  

해결책은 공유 저장소를 만드는 것이다.
즉, 세션값을 저장하는 단일 지점을 만들어서 세션을 필요로 하는 요청들이 이 저장소를 통하게 만드는 것이다.  
이 때 세션 자체는 관계를 저장할 필요는 없으므로 NoSQL을 사용하거나 레디스같은 캐시저장소를 활용하면 좋다.

## 궁금증
- 데이터베이스 다중화를 할 때 쓰기 연산 직후 바로 조회를 하면 데이터 불일치 현상이 발생할 수 있을 것 같다. 이 부분을 어떻게 해결할까?

> 단일 지점의 병목을 해결하기 위해 분산서버를 구성하고 분산서버의 문제를 해결하기 위해 다시 단일 지점을 만든다... 뭔가 돌고 도는 느낌..
> 아직 실제로 이 부분을 경험해보지 않아서 잘 모르는 것 같은데 궁금하구만...