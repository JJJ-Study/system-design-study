# 11장. 뉴스 피드 시스템 설계

뉴스 피드는 홈페이지 중앙에 지속적으로 업데이트되는 스토리들로 구성된다. 쉽게 말해, 페이스북이나 인스타그램 피드, 트위터 타임라인 설계와 같은 것을 말한다.

두 가지 설계안으로 뉴스 피드 시스템을 생각해보자.

1. 피드 발생(feed publishing)
   - 사용자가 스토리를 포스팅하면, 해당 데이터를 캐시와 데이터베이스에 기록
   - 새 포스팅은 친구의 뉴스 피드에도 전송
2. 뉴스 피드 생성 (news feed building)
   - 뉴스 피드는 모든 친구의 포스팅을 시간 흐름 역순으로 모아서 보여줌

### 뉴스 피드 API

- 클라이언트가 서버와 통신하기 위해 사용하는 수단
- HTTP 프로토콜 기반
- 상태 정보 업데이트, 뉴스 피드 조회, 친구 추가 등 다양한 작업 수행

**피드 발행 API**

새 스토리를 포스팅하기 위한 API

```http request
POST /v1/me/feed
Authorization: Bearer <인증 토큰>
Content-Type: application/json

{
  "content": "포스팅 내용이 포함된다."
}
```

**피드 읽기 API**

뉴스 피드를 가져오는 API

```http request
GET /v1/me/feed
Authorization: Bearer <인증 토큰>
```

### 피드 발행

![img.png](승조_이미지/11-2.png)

사용자는 피드 발행 API(`POST /v1/me/feed`)를 통해 새 포스팅을 생성하며, 로드밸런서는 트래픽을 웹 서버들로 분산한다.

이 때 웹 서버는 HTTP 요청을 내부적으로 중계하는 역할을 담당:

- 포스팅 저장 서비스(post service): 새 포스팅을 데이터베이스 및 캐시에 저장
- 포스팅 전송 서비스(fanout service): 새 포스팅을 친구의 뉴스 피드에 푸시(push)하고 뉴스 피드 데이터를 캐시에 저장
- 알림 서비스(notification service): 친구들에게 새 포스팅이 올라왔음을 알리는 역할

### 뉴스 피드 생성

사용자가 보는 뉴스 피드는 어떻게 만들어지는지 살펴보자

![img.png](승조_이미지/11-3.png)

사용자는 뉴스 피드 조회 API(`GET /v1/me/feed`)를 호출하여 뉴스 피드를 가져온다. 위와 마찬가지로 로드밸런서는 트래픽을 웹 서버들로 분산한다.

웹 서버는 트래픽을 뉴스 피드 서비스로 보낸다:

- 뉴스 피드 서비스(news feed service): 캐시에서 뉴스 피드를 가져오는 서비스
- 뉴스 피드 캐시(news feed cache): 뉴스 피드를 렌더링할 때 필요한 피드 ID를 캐시에 보관

