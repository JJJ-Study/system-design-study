# 10장. 알림 시스템 설계

알림의 종륲는 크게 인앱알림과, 푸시 알림 두 가지가 있다.  
이 장에서는 푸시 알림을 중심으로 설계를 진행한다.

## 기본적인 알림 동작 방식
IOS, 안드로이드, SMS 메시지, 이메일 등을 통해서 알림을 보낼 수 있다.  
각각의 유형에 따라서 사용해야 하는 서드파티 서비스는 다르다. 하지만 서비스를 제공하는 주체만 다를 뿐 하는 역할은 모두 같다.  

> 알림을 만든 주체 -> 서드파티 서비스(알림을 보내주는 서비스) -> 단말기

## 개략적 설계안(초안)
서비스 혹은 서비스들은 단일 서버로 알림 시스템 하나를 사용한다.  
알림 시스템은 알림을 제공하는 서드파티 서비스들을 통합해주는 시스템이다.  
애플리케이션 서비스들이 각각 서드파티 서비스에 직접적으로 의존하기보다는 알림시스템의 단일지점을 이용해 확장성을 높이는 것이 좋다.  
왜냐하면 어떤 시장에서는 서드파티 서비스의 제한을 받기도 하는데 실제로 중국에서는 안드로이드 푸쉬알림서비스르 제한한다.  
그러므로 각각의 애플리케이션은 알림시스템에 의존하여 서비스 제한에 대한 영향을 최소화하는 것이 좋다.

## 개략적 설계안(개선된 버전)
하나의 알림시스템에서 각각의 제 3자 제공 서비스로 알림 요청을 보내는 일은 시간이 오래 걸릴 수 있다.  
이 문제는 메세지 큐를 활용해서 요청을 기다리지 않게 하여 해결할 수 있다.  
즉 각각의 제 3자 제공 서비스마다의 알림 큐와 작업서버를 따로 두는 것이다.  

데이터베이스에 사용자, 알림, 설정 등을 저장하고 캐시를 통해 사용자 정보, 단말 정보 등을 캐시한다.

## 상세 설계

### 데이터 손실 방지
알림 전송은 지연되거나 순서가 바뀌어도 상관없지만, 사라지면 안된다.  
이 문제를 해결하기 위해서 알림을 데이터베이스에 보관하고 재시도 매케니즘을 구현해야한다.  
알림 로그 데이터베이스를 유지하는 것이 한가지 방법이다.

### 알림 중복 전송 방지
대부분의 경우 알림은 한번만 전송되겠지만 분산 시스템은 가끔 중복되어 전송된다.  
분산시스템 특성상 중복은 막을 수 없고, 그 빈도를 줄이기 위한 방법으로 중복 탐지 매커니즘을 도입해야한다.
> 분산 시스템은 서로 독립적으로 작동하기 때문에 동기화 문제에 의해 중복 발송 문제가 있다고 한다.

### 전송률 제한
한 사용자가 너무 많은 알림을 받으면 기능을 완전히 꺼버릴수도 있기 때문에 빈도를 적절히 제한하는 것이 중요하다.

### 큐 모니터링
모니터링을 통해 작업 서버들의 상태를 확인하고 적절히 대응하도록 한다.
